---
title: "Week 08 - Bivariate Regression"
output: 
  learnr::tutorial:
    progressive: true
    allow_skip: false
    css: "css/learnr-theme.css"
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
library(learnr)
library(learnrhash)
gradethis::gradethis_setup()

library(tidyverse)
data(df_opposition) 
```

## Introduction

After getting to know `R` and the `tidyverse` in previous weeks, it's now time to run your first statistical model. Following this week's lab session, you continue wondering why opposition parties in European national parliaments vary in their conflict-seeking behavior. Luckily, we have the data from Tuttnauer (2018) which allows us to explore the behavior of parliamentary opposition parties in 16 EU member states.^[Tuttnauer, O. (2018) "If you can beat them, confront them: Party-level analysis of opposition behavior in European national parliaments". *European Union Politics*, 19(2), 278â€“298.] 

Before doing so, however, you have to load the required packages. Moreover, you should also familiarize yourself with the data first. 

### Packages

For the following exercises, you'll only need the **tidyverse** package. All other functions should come with base `R`. You should already have `tidyverse` installed, so just go ahead and load it:

```{r load-packages, exercise=TRUE}

```

```{r load-packages-solution}
library(tidyverse)
```

```{r load-packages-check}
grade_this_code("The tidyverse is now loaded!")
```

## Getting to know the data

As mentioned before, the data for this tutorial is the same data on opposition parties in national European parliaments that we used in the lab. The data set is already preloaded into the environment and called `df_opposition`. Let's check it out.

### The data set

**How many observations and variables does the data frame have?**

```{r check-data-sol,echo = FALSE, eval=FALSE}
dim(df_opposition)
```


```{r check-data, exercise = TRUE}

```


```{r check-data-q1, echo = FALSE}
question_text("Enter the number of observations here:",
  answer("54", correct = T),
  allow_retry = T,
  incorrect = "Hint: Try dim(), nrow(), or glimpse()."
)

```


```{r check-data-q2, echo = FALSE}
question_text("Enter the number of variables here:",
  answer("17", correct = T),
  allow_retry = T,
  incorrect = "Hint: Try dim(), ncol(), or glimpse()."
)

```

### Dependent variable: Voting against the government
 
As in the lab session, we want to better understand why and how often opposition parties vote against the government. Hence, the  percentage of votes opposed to the government is our dependent variable. The corresponding variable in the data set is called `conflict_p`. 

#### Summary statistics

**What is the median value of this variable (in percent and rounded to two meaningful (integer) digits (e.g., 0.23, 4.5, 13))?**


```{r median-conflict-sol, echo = FALSE, eval=FALSE}
median(df_opposition$conflict_p)
```

```{r median-conflict, exercise = TRUE}

```


```{r median-conflict-q, echo = FALSE}
question("The median  of the conflict measure is (in percent and rounded to two meaningful digits):",
  answer("54", correct = T),
  answer("0.5", correct = F, message = "Please report the result in percent and rounded to two digits."),
  answer("0.54", correct = F, message = "Close but remember that you are supposed to report the median in percent."),
  answer("0.054", correct = F, message = "Please report the result in percent and rounded to two digits."),
  answer("50", correct = F, message = "Please report the result rounded to two meaningful (non-zero) digits."),
  answer("53.68", correct = F, message = "Not wrong per se, but too detailed."),
  random_answer_order = TRUE,
  allow_retry = T
)

```


**What is its standard deviation (in percent and rounded to two meaningful (integer) digits (e.g., 0.23, 4.5, 13))?**

```{r sd-conflict-sol, echo = FALSE, eval=FALSE}
sd(df_opposition$conflict_p) %>% round(2)*100
```

```{r sd-conflict, exercise = TRUE}

```

```{r sd-conflict-q, echo = FALSE}
question_text(
  "The standard deviation of the conflict measure is (in percent and rounded to two meaningful digits):",
  answer("0.27", correct = F, message = "Close, but you were asked to report the result in percent."),
  answer("27", correct = T),
  allow_retry = TRUE
)
```

### Independent variable: Party's seat share

One common argument in the literature on opposition parties is that larger opposition parties oppose the government more often than smaller ones. Let's have a closer look at this hypothesis. As a proxy for party size we are taking its seat share in the parliament stored in the variable `seatshare`. Before we run the regression analysis, however, we should know how the variable looks like.

* **Have a look at the variable using a histogram.**
* **Make the plot look nicer by using `theme_minimal()`.**

```{r histogram, exercise = TRUE}

```

```{r histogram-sol}
ggplot(df_opposition) + 
  geom_histogram(aes(x = seatshare)) + 
  theme_minimal() 
```
 
```{r histogram-code-check}
grade_this_code()
```

#### Summary statistics

Now that you got a first visual glimpse at the explanatory variable, let's calculate some summary statistics.

**What is the average value of `seatshare` in the data (in percent and rounded to two non-zero digits)?**

```{r avg-seatshare-sol, eval=FALSE, echo = FALSE}
mean(df_opposition$seatshare) %>% round(2)*100
```

```{r avg-seatshare, exercise = TRUE}

```

```{r avg-seatshare-q, echo = FALSE}
question_text(
  "The average value of `seatshare` is (in percent and rounded to two meaningful digits):",
  answer("12", correct = T),
  allow_retry = T
  )
```

**What is the maximum of `seatshare` (in percent and rounded to two meaningful digits)?**

```{r max-seatshare-sol, echo = FALSE, eval=FALSE}
max(df_opposition$seatshare) %>% round(2)*100
```


```{r max-seatshare, exercise = TRUE}

```


```{r max-seatshare-q, echo = FALSE}
question_text(
  "The maximum seat share of an opposition party in the data is (in percent and rounded to two meaningful digits):",
  answer("41", correct = T),
  allow_retry = T
  )
```

## Bivariate regression

Time to run the regression. Regress the average opposition measure (`conflict_p`) on a party's seat share (`seatshare`) using the data set `df_opposition`.

```{r lm-1-sol, eval=FALSE, echo = FALSE}
lm(conflict_p ~ seatshare, data = df_opposition)
```

```{r lm-1, exercise = TRUE}

```

Please provide an interpretation of the estimated regression coefficient. 

*Note that more than one answer can be correct.*

```{r qlm-1-q, echo = FALSE}
question("What does the coefficient estimate tell us about the relationship between seat share and the share of opposing votes to the government?",
  answer("A one unit increase in seat share is associated with an increase of about 56% in votes against the government.", correct = F, message = "Keep in mind that reporting increases in percent is a relative measure. However, the dependent variable is measured in percentage points."),
    answer("A one unit increase in seat share causes an increase in votes against the government of about 56 percentage points.", correct = F, message = "Be careful when making causal statements. Saying increases in seat share cause an increase in votes would only hold if you assume that there are no confounders, i.e. no unobserved factors that affect both the size of a party in parliament and its behavior vis-a-vis the government. Without randomization or further control variables, this seems not realistic to hold in practice."),
  answer("An increase of one percentage point in vote share is associated with a an increase of about 0.56 percentage points in the the share of votes against the government.", correct = T),
    answer("We expect an increase of about 56 percentage points in the share of votes against the government when the seat share variable increases by one unit.", correct = T),
  random_answer_order = TRUE,
  allow_retry = T
)

```

## Predicted values

Not only does the model help us understand how much the share of votes against the government is expected to change when party size increases, but it also allows us to make predictions. 

**According to our model, how often do parties with a seat share of 30% oppose the government on average? Please provide the answer in percent with two significant (non-zero) digits.**

*(Hint: Note that the `predict()` function might be helpful for this task. You can re-run the regression model in the chunk below. Alternatively, the correct regression output is also already stored in an object called `lm_seatshare`)*

```{r predict_sol, eval = F, echo = F}
lm_seatshare <- lm(conflict_p ~ seatshare, data = df_opposition)

predict(lm_seatshare, newdata = tibble(seatshare = .3)) %>% round(2)*100
```

```{r predict-setup}
lm_seatshare <- lm(conflict_p ~ seatshare, data = df_opposition)
```


```{r predict, exercise=TRUE, exercise.setup = "predict-setup"}

```

```{r predict_q, echo = FALSE}
question_text(
  "Parties with a seat share of 30% oppose the government on average in __ percent of votes.",
  answer("66", correct = T),
  answer("65.61", correct = F, message = "That is too detailed."),
  answer("0.66", correct = F, message = "Please provide the answer in percent."),
  allow_retry = T
)
```


## Submit

```{r context="server"}
learnrhash::encoder_logic()
```

```{r encode, echo=FALSE}
learnrhash::encoder_ui(default_ui(url = "SomeURL"))
```



